<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Rental Prices in the U.S.</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: whitesmoke;
      font-family: Lato, sans-serif;
      color: #0D0000;
    }

    header {
      width: 80%;
      margin: 10px auto 10px auto;
    }

    h1 {
      display: inline-block;
      margin-right: 20px;
      color: #001323;
    }

    h2 {
      display: inline-block;
      color: #001323;
    }

    #map {
      width: 80%;
      height: 540px;
      margin: 10px 10%;
      background: whitesmoke;
      border: 2px solid #dddedf;
    }

    footer {
      padding: 6px 10%;
      width: 80%;
    }

    p {
      font-size: 1em;
      color: #001323;
    }

    .legend {
      padding: 6px 8px;
      font-size: 1em;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }

    .legend {
      padding: 6px 8px;
      font-size: 1em;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }

    .legend h3 {
      font-size: 1.1em;
      font-weight: normal;
      color: #001323;
      margin: 0 0 10px 0;
    }

    .legend span {
      width: 20px;
      height: 20px;
      float: left;
      margin: 0 10px 4px 0;
    }

    .legend label {
      font-size: 1.1em;
    }

    .legend label:after {
      content: '';
      display: block;
      clear: both;
    }
  </style>
</head>

<body>
  <header>
    <h1>Rental Prices in the United States</h1>
    <h2>Average Cost of Rent by County</h2>
  </header>

  <div id='map'></div>

  <footer>
    <p>Map authored by Amanda Abner</p>
    <p>Data sources: <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml"> American FactFinder</a> and <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_counties.html"> US Census Cartographic Boundary Shapefiles of
        Counties</a>. </p>
    <p>
    </p>
  </footer>


  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/simple-statistics@6.1.1/dist/simple-statistics.min.js"></script>

  <script>
    //add map and options
    var options = {
      center: [39.8, -96.5],
      zoom: 4,
      zoomControl: false
    }
    var map = L.map('map', options);

    map.addControl(L.control.zoom({
      position: 'topright'
    }));

    //drawMap function--where my problems begin

    function drawMap(dataLayer) {
      var breaks = getClassBreaks(dataLayer, {

          function getClassBreaks(dataLayer) {
            values = [];

            dataLayer.eachLayer(function(layer) {
                var props = layer.feature.properities
                layer.setStyle({
                  fillColor: getColor(props[attributeValue], breaks)
                });

                function getColor(d, breaks) {
                  if (d <= breaks[0][1]) {
                    return '#f1eef6';
                  } else if (d <= breaks[1][1]) {
                    return '#bdc9e1';
                  } else if (d <= breaks[2][1]) {
                    return '#74a9cf';
                  } else if (d <= breaks[3][1]) {
                    return '#2b8cbe'
                  } else if (d <= breaks[4][1]) {
                    return '#045a8d'
                  }
                }
                var value = props[attributeValue];
                values.push(value);
              )
            };
            var clusters = ss.ckmeans(values, 5);

            var breaks = clusters.map(function(cluster) {
              return [cluster[0], cluster.pop()];
            });
            return breaks;
          }
        )
      };
      console.log(values);
      //  console.log(layer.feature.properties);


      //layer.setStyle( { fillColor: 'green' } );
      //});
      //}

      function drawLedgend(breaks) {
        //console.log(breaks);
        var legend = L.control({
          position: 'topleft'
        });
        legend.onAdd = function() {
          var div = L.DomUtil.create('div', 'legend');
          dive.innerHTML = "<h3>" + attribute + "per" + norm + "</h3>";
          for (var i = 0, i < breaks.length; i++) {
            var color = getColor(breaks[i][0], breaks);
          }
          return div;
        };
        legend.addTo(map);
      }

      var attributeValue = "RENT";

      //add counties/rent data
      $.getJSON("data/counties_median_rent_2015.json", function(data) {
        //console.log(data);
        var dataLayer = L.geoJson(data, {
          style: function(feature) {
            return {
              color: '#dddddd',
              weight: .8,
              fillOpacity: 1,
              fillColor: '#1f78b4'
            };
          }
        }).addTo(map);
        drawMap(dataLayer);
      });

      //add states layer
      $.getJSON("data/us_states_20m.geojson", function(data) {
        //console.log(data);
        var dataLayer = L.geoJson(data, {
          style: function(feature) {
            return {
              color: '#383838',
              weight: 1
            };
          }
        }).addTo(map);
        drawMap(dataLayer);
      });

      console.log(breaks);
  </script>

</body>

</html>
